:root{
  /* ベース */
  --bg:#0b0d12;
  --text:#e7ebf2;
  --accent:#ffce54;
  --danger:#f0625f;

  /* 盤と駒 */
  --squarepx:48px;
  --board-pad:8px; --grid-gap:2px;
  --wood:#b48a55; --cell:#dcb878; --piece:#f1e2bf; --piece-border:#5f5335;

  /* レイアウト寸法（トップバー/駒台は固定高さ） */
  --topbar-h: 40px;
  --hands-h: 58px;

  /* 駒形状（確定値） */
  --piece-scale-x: 0.90;
  --tri-start-y: 22%;
  --trap-top-left: 10%;
  --trap-top-right: 90%;
  --label-shift: 12%;
  --gote-label-bias: 20%;

  /* エレベーション */
  --blur: 16px;
  --shadow-1: 0 6px 24px rgba(0,0,0,0.28);
  --shadow-2: 0 12px 40px rgba(0,0,0,0.35);
}

*{box-sizing:border-box}
html,body{height:100%; margin:0}
body{
  background: radial-gradient(1200px 800px at 20% -10%, #172035 0%, #0e1322 48%, #0b0d12 100%);
  color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
  line-height:1.25;
  /* スクロールを許可（極小画面でもトップバーが切れない保険） */
  overflow:auto;
}

.app{min-height:100vh; width:100vw; display:flex; flex-direction:column}

/* ===== タイトル画面 ===== */
.title-screen{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  background: radial-gradient(900px 700px at 50% 0%, rgba(255,255,255,0.06), rgba(0,0,0,0.6));
  z-index: 50;
}
.title-card{
  width:min(92vw, 420px);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.18);
  border-radius:16px; padding:18px 16px 16px;
  box-shadow: var(--shadow-2);
}
.title-card h1{
  margin:4px 0 12px; font-size: clamp(28px, 6vw, 38px); letter-spacing:.1em; text-align:center;
}
.title-card .row{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  margin:10px 0;
}
.title-card label{ font-weight:700; opacity:.9 }
.title-card select{
  height:34px; border-radius:10px; padding:0 12px;
  background: rgba(255,255,255,0.08);
  color:var(--text); border:1px solid rgba(255,255,255,0.18);
  min-width: 180px;
}
.btn.start{
  width:100%; margin-top:12px; padding:10px 14px; border-radius:12px; font-weight:800;
  background: linear-gradient(180deg, #2a3a63, #1d2a49);
  border:1px solid rgba(117,160,255,0.25);
  color:#eaf2ff;
}

/* ===== Topbar ===== */
.topbar{
  height:var(--topbar-h);
  display:flex; align-items:center; gap:10px;
  padding:0 12px;
  position:sticky; top:0; z-index:10;   /* ← 見切れ防止 */
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.03));
  border-bottom:1px solid rgba(255,255,255,0.06);
  box-shadow: var(--shadow-1);
}
.topbar #turnLabel{
  font-weight:700; letter-spacing:0.02em;
  padding:6px 10px; border-radius:999px;
  background: linear-gradient(180deg, rgba(255,255,255,0.15), rgba(255,255,255,0.06));
  border:1px solid rgba(255,255,255,0.18);
  color:#eaf2ff; text-shadow:0 1px 0 #0007;
  font-size:clamp(11px,2.2vw,13px);
}
.topbar .spacer{flex:1}
.btn{
  border:none; cursor:pointer;
  padding:7px 12px; border-radius:999px;
  font-size:clamp(11px,2.2vw,13px); font-weight:700;
  color:#eaf2ff;
  background: linear-gradient(180deg, #2a3a63, #1d2a49);
  border:1px solid rgba(117,160,255,0.25);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.15), 0 8px 18px rgba(0,0,0,0.25);
}
.btn.danger{
  background: linear-gradient(180deg, #7b2f31, #5a2325);
  border-color: rgba(255,120,120,0.35);
}

/* ===== 駒台 ===== */
.hands{
  height:var(--hands-h);
  display:flex; align-items:center; gap:12px;
  padding:8px 12px;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border-top:1px solid rgba(255,255,255,0.06);
  border-bottom:1px solid rgba(255,255,255,0.06);
  box-shadow: var(--shadow-1);
}
.hand-title{
  color:#d6d9e5; opacity:0.75;
  padding:4px 8px; border-radius:8px;
  font-weight:800; letter-spacing:.02em;
  font-size:clamp(10px,2.1vw,12px);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
  border:1px solid rgba(255,255,255,0.15);
}
.hand{ display:flex; align-items:center; gap:8px; overflow:auto hidden; flex:1; min-width:0 }
.cap{
  display:flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,0.18);
  white-space:nowrap; cursor:pointer;
}
.cap .mini{ width:28px; height:28px; position:relative; display:flex; align-items:center; justify-content:center; color:#2d1d0b; font-weight:800; }
.cap .mini::before,
.cap .mini::after{
  content:""; position:absolute; inset:0;
  clip-path: polygon(50% 0%, var(--trap-top-right) var(--tri-start-y), 100% 100%, 0% 100%, var(--trap-top-left) var(--tri-start-y));
}
.cap .mini::before{ background:var(--piece-border) }
.cap .mini::after{ inset:1.5px; background:var(--piece) }
.cap .count{ color:#e9ecf6; font-weight:800; font-variant-numeric:tabular-nums; padding:2px 6px; border-radius:999px; background: linear-gradient(180deg, rgba(80,110,190,.45), rgba(60,85,160,.35)); border:1px solid rgba(130,170,255,.45) }

/* ===== 盤 ===== */
.board-wrap{ flex:1; display:flex; align-items:center; justify-content:center; padding:10px 12px; position:relative }
.board{
  display:grid; grid-template-columns: repeat(9, var(--squarepx)); grid-template-rows: repeat(9, var(--squarepx));
  gap: var(--grid-gap);
  background:var(--wood); padding: var(--board-pad);
  border-radius:14px; border:1px solid rgba(0,0,0,.25);
  box-shadow: 0 16px 44px rgba(0,0,0,.45);
  max-width:100%; max-height:100%;
}
.fx-layer{ position:absolute; inset:0; pointer-events:none; }

/* マス等 */
.square{
  position:relative; background:var(--cell); border-radius:6px;
  display:flex; align-items:center; justify-content:center;
  user-select:none; -webkit-user-select:none; touch-action:manipulation;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.14);
}
.square.highlight{ outline:3px solid #6aa6ff; outline-offset:-2px }
.square.lastmove{ box-shadow: inset 0 0 0 3px rgba(46, 204, 113, 0.8) }
.square.incheck{ animation: checkPulse 0.9s ease-in-out infinite }
@keyframes checkPulse{
  0%,100%{ box-shadow: inset 0 0 0 3px rgba(231,76,60,0.95), 0 0 18px 6px rgba(231,76,60,0.25) }
  50%    { box-shadow: inset 0 0 0 2px rgba(231,76,60,0.55), 0 0 10px 2px rgba(231,76,60,0.15) }
}

/* 駒 */
.piece{
  --rot: 0deg; --sx: var(--piece-scale-x); --ty: 0;
  position:relative;
  width: calc(var(--squarepx) * 0.86);
  height: calc(var(--squarepx) * 0.86);
  display:flex; align-items:center; justify-content:center;
  font-weight:900; letter-spacing:0.04em; color:#2d1d0b;
  transform: rotate(var(--rot)) scaleX(var(--sx)) translateY(var(--ty));
}
.piece .shape{
  position:absolute; inset:0; background:var(--piece-border);
  clip-path: polygon(50% 0%, var(--trap-top-right) var(--tri-start-y), 100% 100%, 0% 100%, var(--trap-top-left) var(--tri-start-y));
}
.piece .shape::after{
  content:""; position:absolute; inset:2px; background:var(--piece);
  clip-path: inherit;
}
.piece.gote{ --rot: 180deg }
.label{
  position:relative; z-index:1;
  font-size: clamp(12px, calc(var(--squarepx)*0.36), 22px);
  transform: translateY(var(--label-shift));
}
.piece.gote .label{ transform: translateY(calc(-1 * var(--label-shift) + var(--gote-label-bias))) }
.piece.promoted .label{ color:#8b0b0b }

/* 詰みフラッシュ & モーダル */
.mate-flash{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  font-weight:900; font-size: clamp(24px, 8vw, 56px);
  color:#fff; text-shadow: 0 3px 12px #000a;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.35), rgba(0,0,0,0.7));
  animation: flashIn 0.35s ease, fadeOut 1.2s ease 1.2s forwards;
}
@keyframes flashIn{ from{opacity:0; filter:blur(6px)} to{opacity:1; filter:none} }
@keyframes fadeOut{ to{opacity:0} }

/* レスポンシブ */
@media (max-width: 480px){
  :root{ --topbar-h: 38px; --hands-h: 54px; }
  .hand-title{ display:none }
}
